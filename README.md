# RemoteControl - Windows 远程控制系统

<div align="center">

**一个基于 C++/MFC 开发的功能强大的 Windows 远程控制解决方案**

[功能特性](#-功能特性) • [快速开始](#-快速开始) • [技术架构](#️-技术架构) • [使用指南](#-使用指南) • [开发路线图](#️-开发路线图)

</div>

---

## 📖 项目简介

RemoteControl 是一个完整的远程桌面控制系统，采用客户端/服务器架构设计，专为 Windows 平台打造。项目使用现代 C++ 开发，结合 MFC 框架提供友好的图形界面，实现了高效的远程监控和文件管理功能。

### 为什么选择 RemoteControl？

- 🚀 **高性能**：采用线程池和差分算法优化，支持流畅的屏幕传输
- 🎯 **功能完整**：集成屏幕监控、文件管理、输入控制等核心功能
- 🏗️ **架构清晰**：客户端采用 MVC 设计模式，代码结构清晰易维护
- 🔧 **易于扩展**：模块化设计，命令分发系统支持快速添加新功能
- 💻 **Windows 原生**：基于 Windows API 和 MFC，性能优异

---

## ✨ 功能特性

### 🖥️ 远程屏幕监控

- **实时屏幕捕获**：基于 GDI+ 的高效屏幕捕获技术
- **差分传输优化**：使用智能差分算法，仅传输变化区域，大幅降低带宽占用
- **自适应缩放**：支持远程屏幕的自适应显示和比例锁定
- **屏幕录制**：支持远程屏幕录制功能（计划中）

### 📁 文件系统管理

- **完整的文件浏览**：树形视图展示远程主机的磁盘驱动器和目录结构
- **文件传输**：
  - 📤 上传本地文件到远程主机
  - 📥 下载远程文件到本地
- **文件操作**：
  - 🗑️ 删除远程文件
  - ▶️ 远程执行文件
  - 📊 查看文件属性（大小、类型、路径等）
- **实时刷新**：支持实时刷新远程文件列表

### 🖱️ 远程输入控制

- **鼠标控制**：支持远程鼠标移动、点击、双击等操作
- **键盘输入**：远程键盘事件模拟（计划完善中）
- **输入事件优化**：高优先级事件队列，确保控制响应流畅

### ⚙️ 系统控制

- **机器锁定**：远程锁定目标主机
- **命令分发**：灵活的命令处理架构，支持快速扩展新功能
- **异常处理**：完善的 SEH（结构化异常处理）机制，保证系统稳定性

---

## 🏗️ 技术架构

### 系统架构

RemoteControl 采用经典的客户端/服务器（C/S）架构：

```
┌─────────────────────────┐         TCP/IP (Port 9527)         ┌─────────────────────────┐
│   RemoteControl_Client  │ ◄──────────────────────────────► │   RemoteControl_Server  │
│                         │                                    │                         │
│  ┌─────────────────┐   │                                    │  ┌─────────────────┐   │
│  │   MVC 架构      │   │                                    │  │ Command Dispatch│   │
│  │  ┌──────────┐   │   │                                    │  │                 │   │
│  │  │  View    │   │   │    ┌──────────────────┐           │  │  ┌──────────┐   │   │
│  │  │ (MFC UI) │───┼───┼────│  Network Protocol │───────────┼──┼──│ Handlers │   │   │
│  │  └──────────┘   │   │    └──────────────────┘           │  │  └──────────┘   │   │
│  │       ↕          │   │                                    │  └─────────────────┘   │
│  │  ┌──────────┐   │   │                                    │           ↓            │
│  │  │Controller│   │   │                                    │  ┌─────────────────┐   │
│  │  └──────────┘   │   │                                    │  │   Core Services │   │
│  │       ↕          │   │                                    │  │  • ScreenCapture│   │
│  │  ┌──────────┐   │   │                                    │  │  • FileSystem   │   │
│  │  │  Model   │   │   │                                    │  │  • InputSimulate│   │
│  │  └──────────┘   │   │                                    │  │  • LockMachine  │   │
│  └─────────────────┘   │                                    │  └─────────────────┘   │
└─────────────────────────┘                                    └─────────────────────────┘
```

### 客户端架构（MVC 设计模式）

- **View 层**：基于 MFC 的对话框界面，负责 UI 展示和用户交互
  - `RemoteControlViewDlg`：主对话框，管理连接、文件浏览等 UI
  - `MonitorViewDlg`：监控窗口，显示远程屏幕
- **Controller 层**：处理业务逻辑，协调 Model 和 View
  - `MainController`：主控制器，处理连接、文件操作等
  - `MonitorController`：监控控制器，处理屏幕数据和输入事件
- **Model 层**：数据管理和网络通信
  - `NetworkModel`：管理 Socket 连接和数据收发
  - `FileSystemModel`：管理文件系统数据
  - `MonitorModel`：管理屏幕数据和输入事件

### 服务器端架构

- **网络层**：
  - `ServerRunner`：服务器启动和运行管理
  - `CServerSocket`：Socket 封装，支持线程池异步处理
  - `CommandDispatcher`：命令分发器，路由不同类型的请求到对应处理器
- **核心服务**：
  - `CaptureService`：屏幕捕获服务，支持差分算法
  - `FileSystem`：文件系统操作服务
  - `InputSimulator`：输入事件模拟服务
  - `LockMachine`：系统锁定服务

### 网络通信协议

采用自定义二进制协议 `Cpacket`，支持：
- 命令类型标识
- 数据序列化/反序列化
- 文件信息、鼠标事件等结构化数据传输

---

## 🚀 快速开始

### 环境要求

| 组件 | 要求 |
|------|------|
| 操作系统 | Windows 7/8/10/11 (x64) |
| 开发工具 | Visual Studio 2017 或更高版本 |
| 编译器 | MSVC (支持 C++17) |
| SDK | Windows SDK 10.0 或更高版本 |
| 框架 | MFC (包含在 Visual Studio 中) |

### 编译项目

1. **克隆仓库**
   ```bash
   git clone https://github.com/your-username/RemoteControl.git
   cd RemoteControl
   ```

2. **打开解决方案**
   ```bash
   # 使用 Visual Studio 打开
   start RemoteControl.sln
   ```

3. **配置项目**
   - 确认项目配置为 `Release` 或 `Debug`
   - 确认平台为 `x64`（推荐）或 `x86`

4. **编译**
   - 在 Visual Studio 中：`生成` → `生成解决方案` (Ctrl+Shift+B)
   - 或使用 MSBuild 命令行：
     ```bash
     msbuild RemoteControl.sln /p:Configuration=Release /p:Platform=x64
     ```

5. **运行**
   - 服务器端：运行 `RemoteControl_Server/x64/Release/RemoteControl_Server.exe`
   - 客户端：运行 `RemoteControl_Client/x64/Release/RemoteControl_Client.exe`

---

## 📖 使用指南

### 服务器端设置

1. **启动服务器**
   - 运行 `RemoteControl_Server.exe`
   - 服务器默认监听端口：`9527`
   - 控制台会显示："Server is running on port 9527..."

2. **配置防火墙**
   - 确保 Windows 防火墙允许端口 9527 的入站连接
   - 或临时关闭防火墙进行测试

3. **查看日志**
   - 服务器运行时会在控制台输出连接和请求信息

### 客户端使用

1. **启动客户端**
   - 运行 `RemoteControl_Client.exe`
   - 打开主控制面板

2. **连接到服务器**
   - 在"连接设置"区域输入服务器 IP 地址
   - 输入端口号（默认 9527）
   - 点击"连接"按钮
   - 连接成功后，状态指示灯变为绿色

3. **文件管理**
   - **浏览文件**：点击"刷新"加载远程主机的驱动器列表
   - **导航目录**：在左侧树形视图中展开目录
   - **查看文件**：右侧列表显示当前目录的文件和子目录
   - **下载文件**：选中文件，点击"下载"按钮
   - **上传文件**：点击"上传"按钮，选择本地文件
   - **删除文件**：选中文件，点击"删除"按钮（需确认）
   - **运行文件**：选中可执行文件，点击"运行"按钮

4. **屏幕监控**
   - 点击"开始监控"按钮
   - 打开监控窗口，显示远程屏幕实时画面
   - **鼠标控制**：在监控窗口中移动鼠标，实现远程控制
   - **窗口调整**：支持窗口大小调整，自动缩放远程屏幕
   - **停止监控**：关闭监控窗口，停止屏幕传输

5. **断开连接**
   - 点击工具栏的"断开"按钮
   - 或直接关闭客户端程序

---

## 📁 项目结构

```
RemoteControl/
├── RemoteControl.sln              # Visual Studio 解决方案文件
│
├── RemoteControl_Server/          # 服务器端项目
│   ├── include/                   # 头文件目录
│   │   ├── core/                  # 核心服务模块
│   │   │   ├── screenCapture.h    # 屏幕捕获服务
│   │   │   ├── diffAlgorithm.h    # 差分算法
│   │   │   ├── fileSystem.h       # 文件系统服务
│   │   │   ├── InputSimulator.h   # 输入模拟服务
│   │   │   ├── LockMachine.h      # 机器锁定服务
│   │   │   └── Enities.h          # 数据实体定义
│   │   ├── network/               # 网络通信模块
│   │   │   ├── ServerRunner.h     # 服务器启动器
│   │   │   ├── ServerSocket.h     # Socket 封装
│   │   │   └── CommandDispatcher.h # 命令分发器
│   │   ├── ui/                    # UI 相关（锁屏对话框等）
│   │   └── utils/                 # 工具类
│   ├── src/                       # 源文件目录
│   │   ├── RemoteControl_server.cpp # 入口文件
│   │   ├── core/                  # 核心服务实现
│   │   ├── network/               # 网络模块实现
│   │   └── ui/                    # UI 实现
│   └── RemoteControl_Server.vcxproj # 项目配置文件
│
├── RemoteControl_Client/          # 客户端项目
│   ├── mvc/                       # MVC 架构目录
│   │   ├── view/                  # 视图层
│   │   │   ├── RemoteControlViewDlg.h # 主对话框
│   │   │   └── MonitorViewDlg.h   # 监控窗口
│   │   ├── controller/            # 控制器层
│   │   │   ├── IController.h      # 控制器接口
│   │   │   ├── MainController.h   # 主控制器
│   │   │   └── MonitorController.h # 监控控制器
│   │   ├── model/                 # 模型层
│   │   │   ├── NetworkModel.h     # 网络模型
│   │   │   ├── FileSystemModel.h  # 文件系统模型
│   │   │   └── MonitorModel.h     # 监控模型
│   │   └── resources/             # 资源文件（对话框、图标等）
│   ├── include/                   # 协议和接口定义
│   │   └── Protocol/              # 通信协议
│   ├── Enities.h                  # 客户端数据实体
│   ├── RemoteControl_Client.cpp   # 入口文件
│   └── RemoteControl_Client.vcxproj # 项目配置文件
│
└── README.md                      # 项目说明文档
```

---

## 🛠️ 技术栈

### 核心技术

| 技术 | 用途 | 说明 |
|------|------|------|
| **C++17** | 主要开发语言 | 使用现代 C++ 特性（智能指针、lambda、STL 等） |
| **MFC** | GUI 框架 | Microsoft Foundation Classes，Windows 原生 UI |
| **Windows API** | 系统调用 | 屏幕捕获、输入模拟、文件操作等 |
| **GDI+** | 图形处理 | 屏幕图像捕获和处理 |
| **WinSock** | 网络通信 | TCP Socket 实现客户端/服务器通信 |

### 设计模式与技术

- **MVC 模式**：客户端采用 Model-View-Controller 架构分层
- **命令模式**：服务器端使用 `CommandDispatcher` 实现命令分发
- **单例模式**：核心服务如 `CaptureService` 使用单例管理
- **线程池**：服务器端使用线程池处理并发请求
- **RAII**：资源管理（如 `ScopedWindowDC`）
- **SEH**：结构化异常处理，提高稳定性
- **差分算法**：屏幕传输优化，减少带宽占用

### 数据结构与协议

- **自定义二进制协议** (`Cpacket`)：高效的网络数据传输
- **序列化/反序列化**：支持结构化数据（文件信息、鼠标事件等）的传输
- **优先级队列**：输入事件和屏幕数据的分级传输（优化中）

---

## 🗺️ 开发路线图

### ✅ 已完成功能

- [x] 客户端/服务器基础架构
- [x] TCP Socket 网络通信
- [x] 远程屏幕实时捕获和传输
- [x] 屏幕差分算法优化
- [x] 远程文件浏览（磁盘、目录、文件）
- [x] 文件上传/下载功能
- [x] 文件删除和执行功能
- [x] 远程鼠标控制
- [x] 远程机器锁定
- [x] 服务器端线程池
- [x] 客户端 MVC 架构重构
- [x] 响应式 UI 布局
- [x] 异常处理和稳定性优化

### 🚧 进行中

- [ ] **高性能 I/O 优化**：集成 IOCP (I/O Completion Port) 实现 Proactor 异步模式
- [ ] **优先级发送队列**：区分屏幕数据和控制命令的传输优先级

### 📋 计划中的功能

#### 短期目标

- [ ] **远程键盘完整支持**：完善键盘事件的捕获和模拟
- [ ] **屏幕录制功能**：支持将远程屏幕录制为视频文件
- [ ] **多客户端支持**：服务器端支持多个客户端同时连接
- [ ] **加密通信**：集成 TLS/SSL 加密，保护数据传输安全
- [ ] **身份认证**：用户名/密码验证机制
- [ ] **剪贴板同步**：本地和远程剪贴板内容同步

#### 长期目标

- [ ] **跨平台支持**：使用 Qt 重写客户端，支持 Linux 和 macOS
- [ ] **音频传输**：远程音频捕获和播放
- [ ] **文件传输进度**：显示上传/下载进度条
- [ ] **命令行工具**：提供无 GUI 的命令行客户端
- [ ] **Web 管理界面**：基于浏览器的远程控制界面
- [ ] **性能监控**：实时显示 CPU、内存、网络使用情况
- [ ] **端口转发**：通过远程主机访问内网服务

---

## 🤝 贡献指南

欢迎贡献代码、报告问题或提出建议！

### 如何贡献

1. **Fork 本仓库**
2. **创建特性分支**
   ```bash
   git checkout -b feature/your-feature-name
   ```
3. **提交更改**
   ```bash
   git commit -m "Add: 添加某某功能"
   ```
4. **推送到分支**
   ```bash
   git push origin feature/your-feature-name
   ```
5. **提交 Pull Request**

### 代码规范

- **命名风格**：
  - 类名使用 PascalCase（如 `CServerSocket`）
  - 函数名使用 PascalCase（MFC 风格）或 camelCase（现代 C++ 风格）
  - 变量名使用 camelCase 或 snake_case
  - 成员变量使用 `m_` 前缀（如 `m_socket`）
- **注释**：使用中文或英文清晰注释复杂逻辑
- **格式化**：建议使用 clang-format 或 Visual Studio 自动格式化
- **错误处理**：使用异常或返回值明确处理错误情况

### 提交信息规范

```
<类型>: <简短描述>

<详细描述>（可选）

类型：
- Add: 新增功能
- Fix: 修复 Bug
- Update: 更新功能
- Refactor: 重构代码
- Docs: 文档更新
- Style: 代码格式调整
- Perf: 性能优化
- Test: 测试相关
```

---

## 🐛 常见问题

### Q: 连接失败，显示"连接超时"或"拒绝连接"

**A:** 请检查以下几点：
1. 确认服务器程序正在运行
2. 检查服务器 IP 地址是否正确
3. 确认防火墙是否允许端口 9527 的入站连接
4. 如果在虚拟机环境，检查网络模式（推荐使用桥接模式）

### Q: 屏幕监控画面卡顿或延迟高

**A:** 可能的原因和解决方案：
1. **网络带宽不足**：尝试在局域网环境测试
2. **CPU 占用高**：关闭其他占用资源的程序
3. **调整刷新率**：在代码中调整屏幕捕获频率（计划添加配置选项）

### Q: 文件传输失败

**A:** 请确认：
1. 目标路径有足够的磁盘空间
2. 对目标路径有读写权限
3. 文件未被其他程序占用
4. 网络连接稳定

### Q: 如何修改默认端口？

**A:** 
- **服务器端**：修改 `RemoteControl_server.cpp` 中的 `ServerRunner runner(9527);` 参数
- **客户端**：在连接界面的"端口"输入框中输入新端口号

---

## 📄 许可证

本项目采用 **MIT License** 开源许可证。

这意味着您可以自由地：
- ✅ 使用本项目进行商业或非商业用途
- ✅ 修改和分发本项目
- ✅ 在您的项目中集成本项目代码

唯一的要求是：
- 📌 保留原作者的版权声明

详细信息请参阅 [LICENSE](LICENSE) 文件（如果适用）。

---

## 📧 联系方式

如有问题或建议，欢迎联系：

- **GitHub Issues**: [提交 Issue](https://github.com/your-username/RemoteControl/issues)
- **Email**: your-email@example.com

---

## 🙏 致谢

感谢所有为本项目贡献代码、报告问题和提出建议的开发者！

本项目在开发过程中参考了以下优秀的开源项目和资源：
- Microsoft MFC 文档和示例
- Windows API 官方文档
- 各种远程控制和网络编程相关的技术文章

---

<div align="center">

**如果这个项目对您有帮助，请给个 ⭐ Star 支持一下！**

Made with ❤️ by [Your Name]

</div>